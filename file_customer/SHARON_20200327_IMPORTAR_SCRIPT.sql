#escribir datos para importar
SET @varCompanyName  = 'SHARON';
SET @varAbreviatura  = 'SHR';
SET @varFormatDate  	= '%d/%m/%Y';


delete from tb_customer_credit_external_sharon_tmp where createdOn = curdate();
insert into tb_customer_credit_external_sharon_tmp (companyName,dateCredit,documentNumber,customerName,customerIdentification,customerPhone,amountAurotize,plazo,formPay,amountShare,amountBalance,dayMora,address,isActive,createdOn) 
values 
('SHARON','03/12/2018','','00686-WHITNEY INDIANA LOPEZ GARCIA','001 - 230893 -0038F','84698849 ,',5000,'6 Meses','QUINCENAL',500,1900,'291 dias','Urbanizacion San Miguel, bloque 2, casa #2 H25',1,CURDATE()),
('SHARON','12/12/2018','','00701-CARLOS JOSE LEIVA ESCOBAR','001 - 070984 - 0070L','',5500,'6 meses','QUINCENAL',380,1700,'92 dias','Ciudad Sandino,zona 1 de laleche agria el vaquero 5c alalago casa verde',1,CURDATE()),
('SHARON','12/12/2018','','00702-BRYAN JOSE GUTIERREZ NAVARRETE','001 - 151199 - 1002K','57828090',16500,'12 MESES','QUINCENAL',660,11540,'','Ciudad Sandino, Zona 2 Oficinas de Inss 1C. Al Norte , 1c Oeste Casa K19',1,CURDATE()),
('SHARON','12/12/2018','','00703-YASER DE JESUS SOZA ESTRADA','001 - 241091 - 0035D','87568764',22500,'12 MESES','QUINCENAL',900,9050,'103  dias','Bo. Pedro Juaquin Chamarro casa hacienda 1c. Abajo 1/2c N. M/I',1,CURDATE()),
('SHARON','13/12/2018','','00707-FATIMA ANGELICA SOZA ESTRADA','001 - 110586 - 0036V','89517953',22500,'12 MESES','QUINCENAL',900,15550,'92 dias','Ciudad Sandino, zona 4 gallo mas gallo 3c alnorte 1ceste M/D',1,CURDATE()),
('SHARON','24/12/2018','','00731-CLAUDIA M. LAGUNA LACAYO','001 - 071282 - 0051V','88638533, 58809090',10500,'10 Meses','QUINCENAL',476,2200,'152 dias','Km 15carretera Xiloa( Monte Sion), 3 1/2 c al sur',1,CURDATE()),
('SHARON','30/12/2018','','00745-YURI DEL CARMEN MENDOZA FLORES','001 280988 - 0064D','87658850',11800,'11 meses','QUINCENAL',500,5250,'121 dias','Ciudad Sandino , gallo mas gallo 3c Norte, 1c Este Casa Esquinera',1,CURDATE()),
('SHARON','30/12/2018','','00746-MIGDALIA OBREGON ALVAREZ','287 - 051089 - 0000J','77860668',17000,'12 MESES','QUINCENAL',660,2160,'83 dias','Bosques de Xiloa Tanque intur 1/2c sur casa #27 M/D',1,CURDATE()),
('SHARON','27/12/2018','','00762-SINDY DAMARIS DARCE GARCIA','001 - 200289 - 0058D','86557599',8000,'9 meses','QUINCENAL',400,1000,'179dias','Ciudad Sandino zona #4 colegio reberto clemente 75 vrs. Al oeste ',1,CURDATE()),
('SHARON','10/01/2019','73','00763-JUNIETH RODRIGUEZ FLORES','283-161198-1000H','7707-7405',17000,'12 MESES','SEMANAL',330,4460,'52 DIAS','C/S ZONA 11 DEL MERCADITO 15 C.NORTE M/I',1,CURDATE()),
('SHARON','24/01/2019','102','00803-JOSSELING IZAMAR ROBLES','001-030995-0031A','7878-7301',20000,'12 MESES','QUINCENAL',750,4400,'59 DIAS','C/S ZONA 7 ARENERA; PLANTA ELECTRICA 2C.E 4C.SUR',1,CURDATE()),
('SHARON','09/03/2019','123','00873-MARLON EDUARDO PEREZ','001-121098-1045M','8299-5458',14500,'12 MESES','SEMANAL',290,4650,'19 DIAS','C/S ZONA 11 COLEGIO ENRIQUE SMITH 4C. NORTE M/D',1,CURDATE()),
('SHARON','22/03/2019','170','00211-ISMAEL JOSUE DAVIS','001-300393-0053E','8278-8036',19500,'12 MESES','QUINCENAL',740,10740,'1 DIAS','CIUDAD EL DORAL CALLE 2 AVENIDA 29 CASA I.63',1,CURDATE()),
('SHARON','22/03/2019','169','00912-YAHOSKA MARIELA SOTELO','001-190796-1007C','8626-2983',16500,'12 MESES','QUINCENAL',640,11860,'1 DIAS','C/U ZONA 11 COLEGIO ENRIQUE SMITH 4.NORTE 1.ESTE',1,CURDATE()),
('SHARON','17/05/2019','5154','00981-KEYLA MASSIEL FLORES','001-240887-0018F','8501-3346',20000,'12 MESES','QUINCENAL',750,9650,'','C/S ZONA 6 DDF TERMINAL 210 3C.NORTE 1C.ESTE M/D',1,CURDATE()),
('SHARON','18/01/2019','113','00788-LUIS MALDONADO ESPINALES','001-080590-0039V','8743-4717',19000,'12 MESES','QUINCENAL',750,13400,'66 DIAS','C/SANDINO,ZONA 4, GALLO+GALLO 3C. N, 2C. E, 1/2 N.',1,CURDATE()),
('SHARON','19/01/2019','86','00789-DARWING IVAN BURGOS','001-220383-0013X','8697-1301',15500,'12 MESES','QUINCENAL',585,4500,'65 DIAS','C/SAND.ZONA 11, COLEGIO ENRIQUE SMITH 3C.N, 1/2O M/D',1,CURDATE()),
('SHARON','23/01/2019','7','00801-MARISELA ANTONIA GUTIERREZ','001-120489-0030T','',11800,'10 MESES','SEMANAL',270,2440,'61 DIAS','C/S B째 SAN FRANC. IGLESIA MORAVA 1C.N,1C.E, 1/2C.S LOTE 29',1,CURDATE()),
('SHARON','26/01/2019','107','00804-MAYERLING JOSSELINE CALERO','001-161295-0060E','7518-5572',11000,'12 MESES','QUINCENAL',420,5590,'58 DIAS','C/S PULPERIA ROMERO 1C. OESTE, 1 1/2C. NORTE',1,CURDATE()),
('SHARON','21/01/2019','90','00809-HENRY DAVID SUAZO','001-271279-0060Q','7869-5497',27000,'12 MESES','QUINCENAL',1050,8150,'63 DIAS','CUAHACHILLO N째 1, TERMINAL 125 400Vrs SUR, 200Vrs OESTE',1,CURDATE()),
('SHARON','30/01/2019','46','00822-OSCAR DANILO ESTRADA','041-110662-0001Q','',5500,'6 MESES','SEMANAL',190,4110,'54 DIAS','PEDRO JUAQUIN, CANCHA DEPORTIVA 1/2C. SUR M/I',1,CURDATE()),
('SHARON','30/01/2019','45','00823-RUTH NOHEMI FUENTES R','001-010874-0076C','8575-0737',20000,'12 MESES','SEMANAL',400,16400,'54 DIAS','C/S ZONA 6 W29. DEL MANGUITO 2 1/2C. AL SUR.',1,CURDATE()),
('SHARON','09/02/2019','146','00828-SUYEN DEL SOCORRO ESTRADA','001-150590-0035G','7882-5539',11000,'12 MESES','QUINCENAL',420,5080,'44 DIAS','C/SANDINO IGLESIA MORAVA 1C. NORTE, 1C. ESTE',1,CURDATE()),
('SHARON','09/02/2019','5466','00829-DAYANA FLORES ESTRADA','001-270596-0033X','8415-4709',21950,'12 MESES','MENSUAL',1696,3300,'44 DIAS','DE PLAZA INTER 1C. AL LAGO, 4C. ABAJO, 2C. LAGO.',1,CURDATE()),
('SHARON','08/02/2019','145','00830-VILMA RAQUEL ORTEGA','001-290396-1001R','7604-1664',15000,'12 MESES','QUINCENAL',563,12940,'45 DIAS','C/S DE LA AGUJA SANTA EDUVIGES 100Vrs NORTE, 1/2C. OES.',1,CURDATE()),
('SHARON','12/02/2019','10','00831-STEIFE GABRIELA GUERRA','088-270693-0000X','8797-2758',39000,'12 MESES','SEMANAL',750,20840,'41 DIAS','CIUDAD EL DORAL CALLE 2 AVENIDA 29 CASA I.65 (MATEARE)',1,CURDATE()),
('SHARON','09/02/2019','5470','00832-JAQUELINE DEL CARMEN MALTEZ','001-060585-0015S','',1000,'3 MESES','QUINCENAL',150,400,'44 DIAS','C/S ZONA 5 CASA G N째11',1,CURDATE()),
('SHARON','21/02/2019','4524','00844-JIMMY ANTONIO MURILLO CERDA','001-160992-005U','7864-6267',11000,'6 MESES','SEMANAL',420,9300,'33 DIAS','C/SANDINO SANTA EDUVIGE, CASA J14',1,CURDATE()),
('SHARON','11/03/2019','125','00881-NORLAN ALEXANDER LOPEZ','001-151100-1071L','8827-1135',5500,'10 MESES','SEMANAL',115,1280,'13 DIAS','C/SANDINO ZONA 10, DE EMENSA 4C. SUR',1,CURDATE()),
('SHARON','18/03/2019','133','00883-DAVID JAFFET RUIZ','001-230680-0070X','5734-1470',11000,'12 MESES','QUINCENAL',420,5800,'9 DIAS','DE PLAZA INTER 1C. AL LAGO, 4C. ABAJO, 2C. LAGO.',1,CURDATE()),
('SHARON','15/03/2019','168','00884-MIGUEL NEFTALY ORTIZ','001-311088-0054F','5889-1705',11000,'12 MESES','QUINCENAL',420,2660,'9 DIAS','C/SANDINO, ZONA 11, IGLESIA CRISTO VIENE 3 1/2C. ESTE',1,CURDATE()),
('SHARON','15/03/2019','166','00886-ARMADO MANUEL ESPINOZA','001-060373-0009N','7512-0078',12200,'12 MESES','SEMANAL',230,6600,'9 DIAS','C/SANDINO DEL MERCADITO 1C. AL LAGO Y 1/2 OESTE',1,CURDATE()),
('SHARON','23/03/2019','5086','00946-DONALD ALJADY FUENTES PAIZ','001-020775-0003N','8687-4864',20600,'12 MESES','SEMANAL',395,8300,'1 DIAS','C/SANDINO ZONA 6, CASA DE ZINC 1C. ABAJO, 1/2C. SUR',1,CURDATE()),
('SHARON','11/05/2019','4799','00968-MARIA FELIX ZURIGA','001-230484-0014C','8117-8876',17000,'10 MESES','QUINCENAL',750,12250,'13 DIAS','VILLA SAN MIGUE, DE LA AGUJA PRINCIPAL 7C.S 1/2C.O. M/D',1,CURDATE()),
('SHARON','11/05/2019','4797','00969-RONAL GEOVANY LOPEZ','001-041299-1010P','8252-9427',2600,'3.5 MESES','QUINCENAL',280,1640,'210 DIAS','C/S ZONA 11 DEL PUENTE VERDE 10 1C.N. 1C.E Y 1C.N',1,CURDATE()),
('SHARON','04/05/2019','4794','00971-SONIA ISABEL CRUZ','001-120447-0002R','2232-3699',11000,'10 MESES','QUINCENAL',500,3200,'20 DIAS','BATAOLA NORTE',1,CURDATE()),
('SHARON','17/05/2019','85','00979-HEYDI DE JESUS GONZALES','001-291182-0028M','8107-5718',23000,'5 MESES','QUINCENAL',270,16100,'282 DIAS','C/S ZONA 11 PUENTE VERDE 1C.O 1C.N 1C.E 1/2C.N',1,CURDATE()),
('SHARON','01/06/2019','5202','01000-JORGE ANTONIO SANCHEZ OBREGON','001-150689-0017Y','8255-8030',5300,'5.5 MESES','QUINCENAL',400,4100,'188 DIAS','B째 BOER ROTONDA PLAZA INTER 1C.N 1/2C.O',1,CURDATE()),
('SHARON','18/07/2019','5179','01046-PABLO JOSE JARQUIN','001-240560-0057W','8132-2230',15318,'10 MESES','QUINCENAL',680,9003,'','SEMAFORO DEL DORADO 75VRS. ESTE',1,CURDATE()),
('SHARON','22/07/2019','5181','01047-JASON EFRAIN TRIANA','001-311295-0007E','7678-4515',20000,'12 MESES','QUINCENAL',750,14580,'','C/S TERMINAL133 1C.N 3C.E',1,CURDATE()),
('SHARON','22/07/2019','5182','01048-DORA ESTELA GUTIERREZ ','001-040191-0065J','8197-9526',18000,'12 MESES','QUINCENAL',680,9220,'','C/S ZONA 12 AGUJA PRINCIPAL SANTA EDUVIJE',1,CURDATE());



##Aplicar Formato
delete from tb_customer_credit_external_sharon; #where createdOn = curdate();
insert into tb_customer_credit_external_sharon (
	companyID,
	TIPO_DE_ENTIDAD,
	NUMERO_CORRELATIVO,
	FECHA_DE_REPORTE,
	DEPARTAMENTO,
	NUMERO_DE_CEDULA_O_RUC,
	NOMBRE_DE_PERSONA,
	TIPO_DE_CREDITO,
	FECHA_DE_DESEMBOLSO,
	TIPO_DE_OBLIGACION,
	MONTO_AUTORIZADO,
	PLAZO,
	FRECUENCIA_DE_PAGO,
	SALDO_DEUDA,
	ESTADO,
	MONTO_VENCIDO,
	ANTIGUEDAD_DE_MORA,
	TIPO_DE_GARANTIA,
	FORMA_DE_RECUPERACION,
	NUMERO_DE_CREDITO,
	VALOR_DE_LA_CUOTA,
	isActive,
	createdOn
) 
select 
	2 as companyID,
	'03' AS TIPO_DE_ENTIDAD,
	'552' AS NUMERO_CORRELATIVO,
	date_format(now(),'%d/%m/%Y') AS FECHA_DE_REPORTE,
	'08' AS `DEPARTAMENTO`,
	REPLACE(REPLACE(LTRIM(RTRIM(c.customerIdentification)),'-',''),' ','') as NUMERO_DE_CEDULA_O_RUC,
	SUBSTR(LTRIM(RTRIM(c.customerName)),7,length(LTRIM(RTRIM(c.customerName)))) as NOMBRE_DE_PERSONA,
	'04' as TIPO_DE_CREDITO,
   DATE_FORMAT(STR_TO_DATE ( LTRIM(RTRIM(c.dateCredit)), @varFormatDate ),'%d/%m/%Y')   AS FECHA_DE_DESEMBOLSO,		   
   '01' AS TIPO_DE_OBLIGACION,
	c.amountAurotize AS MONTO_AUTORIZADO,	 
	case 
		when  c.formPay = 'SEMANAL' then 		
			4 * REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(LTRIM(RTRIM(c.plazo)),' ',''),'MESES',''),'meses',''),'mes',''),'MES',''),'Meses',''),'Mes','')
		when  c.formPay = 'QUINCENAL' then 
			2 * REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(LTRIM(RTRIM(c.plazo)),' ',''),'MESES',''),'meses',''),'mes',''),'MES',''),'Meses',''),'Mes','')
		when  c.formPay = 'MENSUAL' then 
			1 * REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(LTRIM(RTRIM(c.plazo)),' ',''),'MESES',''),'meses',''),'mes',''),'MES',''),'Meses',''),'Mes','')
		else
			0
	end AS PLAZO,
	case 
		when  c.formPay = 'SEMANAL' then 		
			'07'
		when  c.formPay = 'QUINCENAL' then 
			'06'
		when  c.formPay = 'MENSUAL' then 
			'05'
		else
			'00'
	end as FRECUENCIA_DE_PAGO, 	
	c.amountBalance AS SALDO_DEUDA,
	'01' /*01 ACTIVO     02 VENCIDO    03 CANCELADO*/ ESTADO,
	CASE 
		WHEN 
			(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(LTRIM(RTRIM(c.dayMora)),' ',''),'DIAS',''),'dias',''),'dia',''),'dias','') = '')
			OR 
			(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(LTRIM(RTRIM(c.dayMora)),' ',''),'DIAS',''),'dias',''),'dia',''),'dias','') = '0')
		THEN 
			0   
		ELSE   
			c.amountBalance
	END AS  MONTO_VENCIDO,		
	case 
		when REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(LTRIM(RTRIM(c.dayMora)),' ',''),'DIAS',''),'dias',''),'dia',''),'dias','') <> '' then 
			REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(LTRIM(RTRIM(c.dayMora)),' ',''),'DIAS',''),'dias',''),'dia',''),'dias','') 
		else 
			'0'
	end as ANTIGUEDAD_DE_MORA,
	'04' AS TIPO_DE_GARANTIA,
	'03' /*01 normal, 02 arreglo de pago, 03 extra judicial  04 cobro administrativo,  05 cobro judicial */ AS FORMA_DE_RECUPERACION,	
	case 
		when LTRIM(RTRIM(c.documentNumber)) = '' then 
			concat(@varAbreviatura,right(concat('00000000',c.customerID),8))
		else 
			concat(@varAbreviatura,right(concat('00000000',LTRIM(RTRIM(c.documentNumber))),8))
	end AS NUMERO_DE_CREDITO,
	c.amountShare AS VALOR_DE_LA_CUOTA ,
	c.isActive,
	c.createdOn 
from 
	tb_customer_credit_external_sharon_tmp c  
where 
	c.createdOn = curdate() and isActive = 1  and 
	LTRIM(RTRIM(c.customerIdentification)) <> '';


#actualizar: REGISTROS CON MONTOS VENCIDOS, ACTUAIZAR ESTADO A VENCIDOS
update tb_customer_credit_external_sharon SET ESTADO = '02' where MONTO_VENCIDO > 0;  



#Mostrar Creditos Disponibles 
select  * from tb_customer_credit_external_sharon c;